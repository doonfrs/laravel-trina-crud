# Configuration Options

This guide explains all available configuration options for Laravel TrinaCrud and how to customize its behavior to fit your application's needs.

## Publishing the Configuration

Before you can customize the configuration, you need to publish it:

```bash
php artisan vendor:publish --provider="Trinavo\TrinaCrud\Providers\TrinaCrudServiceProvider" --tag="config"
```

This creates a `config/trina-crud.php` file in your application.

## Basic Configuration Options

### Route Prefix

```php
'route_prefix' => env('TRINA_CRUD_ROUTE_PREFIX', 'trina-crud'),
```

This setting determines the prefix for all API routes generated by TrinaCrud. For example, with the default setting, your endpoints would be available at:

```plaintext
/api/trina-crud/products
```

You can change this in your `.env` file:

```plaintext
TRINA_CRUD_ROUTE_PREFIX=api/v1
```

### Middleware Configuration

```php
'api_middleware' => ['api', 'auth:sanctum'],
'admin_middleware' => ['web', 'auth', 'role:admin'],
```

- `api_middleware`: Applied to all API endpoints
- `admin_middleware`: Applied to administrative routes (like permission management UI)

Customize these to match your application's authentication and authorization requirements.

## Security Configuration

### Model Namespace Restrictions

```php
'allowed_model_namespaces' => [
    'App\\Models',
    // Add other authorized namespaces here
],
```

This is an important security feature that restricts which model namespaces can be accessed through the TrinaCrud API. Only models within these namespaces will be available for CRUD operations.

**Why this matters:**

- Prevents attackers from accessing sensitive system classes
- Restricts API access to only your intended models
- Reduces the attack surface of your application

**Best practices:**

1. Use the most specific namespaces possible (e.g., `App\\Models\\Public` instead of `App\\`)
2. For multi-module applications, list each module's namespace explicitly
3. Never include root PHP namespaces or framework system namespaces

**Example configuration for a complex application:**

```php
'allowed_model_namespaces' => [
    'App\\Models\\Public',
    'App\\Models\\Shop', 
    'Modules\\Blog\\Models',
],
```

## Service Customization

TrinaCrud is built with dependency injection in mind, allowing you to replace core services with your own implementations.

### Custom Authorization Service

If you don't want to use Spatie Laravel Permission, you can create your own authorization service. Here's how:

**Step 1:** Create a custom implementation of the `AuthorizationServiceInterface`:

```php
<?php

namespace App\Services;

use Trinavo\TrinaCrud\Contracts\AuthorizationServiceInterface;
use Trinavo\TrinaCrud\Enums\CrudAction;

class CustomAuthorizationService implements AuthorizationServiceInterface
{
    public function authModelPermission(string $modelClass, CrudAction $action): bool
    {
        // Your custom authorization logic here
        // Return true if the current user has permission to perform the action on the model
        return true;
    }

    public function authHasAttributePermission(string $modelClass, string $attribute, CrudAction $action): bool
    {
        // Your custom attribute-level authorization logic here
        // Return true if the current user has permission to access/modify the attribute
        return true;
    }
}
```

**Step 2:** Bind your implementation in a service provider:

```php
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use Trinavo\TrinaCrud\Contracts\AuthorizationServiceInterface;
use App\Services\CustomAuthorizationService;

class AppServiceProvider extends ServiceProvider
{
    public function register()
    {
        $this->app->bind(AuthorizationServiceInterface::class, CustomAuthorizationService::class);
    }
}
```

### Custom Ownership Service

Similarly, you can replace the default ownership service with your own implementation:

**Step 1:** Create a custom implementation of the `OwnershipServiceInterface`:

```php
<?php

namespace App\Services;

use Illuminate\Database\Eloquent\Builder;
use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Eloquent\Relations\Relation;
use Trinavo\TrinaCrud\Contracts\OwnershipServiceInterface;

class CustomOwnershipService implements OwnershipServiceInterface
{
    public function addOwnershipQuery(
        Builder|Relation $query,
        Model $model,
        string $action
    ): Builder|Relation {
        // Your custom ownership logic here
        // For example, limit query to only return records owned by the current user
        $user = auth()->user();
        return $query->where('user_id', $user->id);
    }
}
```

**Step 2:** Bind your implementation in a service provider:

```php
<?php

namespace App\Providers;

use Illuminate\Support\ServiceProvider;
use Trinavo\TrinaCrud\Contracts\OwnershipServiceInterface;
use App\Services\CustomOwnershipService;

class AppServiceProvider extends ServiceProvider
{
    public function register()
    {
        $this->app->bind(OwnershipServiceInterface::class, CustomOwnershipService::class);
    }
}
```

## Response Formatting

You can customize how API responses are formatted:

```php
'response_format' => [
    'success' => true,
    'include_meta' => true,
    'wrap_data' => 'data',
],
```

- `success`: Include a success flag in responses
- `include_meta`: Include metadata like pagination info
- `wrap_data`: Wrap the response data in a key (e.g., 'data')

## Model Configuration

### Default Pagination

```php
'pagination' => [
    'per_page' => 15,
    'max_per_page' => 100,
],
```

This controls the default pagination settings for list endpoints.

## Advanced Configuration

These options are for more advanced use cases and are generally not needed for basic usage.

### Custom Route Registration

```php
'register_routes' => true,
```

If set to `false`, TrinaCrud will not automatically register routes. You can then register them manually in your application's route files.

### Custom Controller Namespace

```php
'controller_namespace' => 'App\\Http\\Controllers\\Api',
```

If you need to place controllers in a specific namespace, you can configure this option.

## Example: Complete Configuration File

```php
<?php

return [
    'route_prefix' => env('TRINA_CRUD_ROUTE_PREFIX', 'trina-crud'),
    
    'api_middleware' => ['api', 'auth:sanctum'],
    'admin_middleware' => ['web', 'auth', 'role:admin'],
    
    'pagination' => [
        'per_page' => 15,
        'max_per_page' => 100,
    ],
    
    'response_format' => [
        'success' => true,
        'include_meta' => true,
        'wrap_data' => 'data',
    ],
    
    'register_routes' => true,
    'controller_namespace' => 'App\\Http\\Controllers\\Api',
];
```

## Next Steps

Now that you understand how to configure TrinaCrud, you might want to:

- Learn about [The HasCrud Trait](has-crud-trait.md) in depth
- Set up [Model & Attribute Security](model-attribute-security.md)
- Explore [Advanced Usage](advanced-usage.md) options
